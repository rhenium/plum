language: ruby
addons:
  code_climate:
    repo_token: f5092ab344fac7f2de9d7332e00597642a4d24e3d560f7d7f329172a2e5a2def
env:
  - INSTALL_RUBY_VERSION=2.2.3-alpn INSTALL_RUBY_PARAMS='--patch https://gist.githubusercontent.com/rhenium/b1711edcc903e8887a51/raw/2309e469f5a3ba15917d804ac61b19e62b3d8faf/ruby-openssl-alpn-no-tests-and-docs.patch'
  - INSTALL_RUBY_VERSION=ruby-head INSTALL_RUBY_PARAMS=''
install:
  - rvm get head
  - echo openssl_url=https://www.openssl.org/source >> $rvm_path/user/db
  - echo openssl_version=1.0.2d >> $rvm_path/user/db
  - rvm pkg install openssl
  - $rvm_path/usr/bin/openssl version
  - rvm install $INSTALL_RUBY_VERSION $INSTALL_RUBY_PARAMS --with-openssl-dir=$rvm_path/usr
  - rvm use $INSTALL_RUBY_VERSION
  - gem install bundler
  - bundle install
script:
  - bundle exec rake test
